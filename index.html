<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Emoji Card Frenzy â€“ 3D Depth</title>
<style>
  :root{ --cardW:105px; --cardH:150px; }
  body{
    margin:0; padding:0; height:100vh; overflow:hidden;
    background:linear-gradient(#87ceeb, #e0f7fa);
    font-family:Arial,Helvetica,sans-serif;
    perspective:1000px;
  }
  .game-container{position:relative;width:100%;height:100%;transform-style:preserve-3d;}

  .collection-area{
    position:absolute;right:10px;top:10px;width:180px;height:220px;
    background:rgba(255,255,255,.7);border-radius:15px;padding:10px;
    display:flex;flex-direction:column;align-items:center;
    box-shadow:0 4px 12px rgba(0,0,0,.25);
  }
  .collection-title{font-weight:bold;margin-bottom:8px;}
  .collection-count{font-size:24px;margin-bottom:5px;}
  .collected-cards{
    display:flex;flex-wrap:wrap;justify-content:center;
    max-height:160px;overflow-y:auto;width:100%;
  }
  .collected-image{font-size:28px;margin:2px;}
  .collected-emoji{font-size:28px;margin:2px;}
  .score{
    position:absolute;top:10px;left:10px;
    font-size:24px;font-weight:bold;color:#333;
  }
  .start-button{
    position:absolute;top:50%;left:50%;
    transform:translate(-50%,-50%);
    padding:15px 30px;font-size:20px;
    background:#673ab7;color:#fff;border:none;border-radius:10px;
    cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.3);
  }
  .start-button:hover{background:#5e35b1;}

  /* card 3-D wrapper */
  .card-scene{
    position:absolute;width:var(--cardW);height:var(--cardH);
    transform-style:preserve-3d;
  }
  .card-face{
    position:absolute;width:100%;height:100%;
    backface-visibility:hidden;border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,.3);
  }
  .card-front{
    background:#fff;display:flex;align-items:center;
    justify-content:center;font-size:40px;
    overflow:hidden;
  }
  .card-back{
    background:repeating-conic-gradient(from 0deg at 50% 50%, #8e24aa 0 20deg, #9c27b0 20deg 40deg);
    transform:rotateY(180deg);
  }

  /* click ripple */
  .catchRipple{
    position:absolute;border-radius:50%;
    background:rgba(255,255,255,.6);
    pointer-events:none;
    transform:translate(-50%,-50%);
    animation:growRipple .4s ease-out forwards;
  }
  @keyframes growRipple{
    0%{width:0;height:0;opacity:1;}
    100%{width:160px;height:160px;opacity:0;}
  }

  /* wind gush */
  .windLine{
    position:absolute;left:0;width:100%;height:120px;
    background:linear-gradient(to top,rgba(255,255,255,.25),transparent);
    transform:translateY(0);opacity:0;pointer-events:none;
  }
  .windLine.blow{
    animation:windUp .8s ease-out forwards;
  }
  @keyframes windUp{
    0%{transform:translateY(0);opacity:0;}
    50%{transform:translateY(-100px);opacity:.8;}
    100%{transform:translateY(-200px);opacity:0;}
  }
</style>
</head>
<body>
  <div class="game-container">
    <div class="score">Score: <span id="scoreValue">0</span></div>
    <div class="collection-area">
      <div class="collection-title">Collected</div>
      <div><span id="collectionCount">0</span> / <span id="totalCards">0</span></div>
      <div class="collected-cards" id="collectedEmojis"></div>
    </div>
    <div class="windLine" id="windLine"></div>
    <button class="start-button" id="startButton">Start Game</button>
  </div>

<script>
// Array to store actual image filenames from directory
let imageFiles = [];

// Function to load the actual list of files from imgs directory
async function loadImageList() {
  try {
    const response = await fetch('imgs/');
    const text = await response.text();
    
    // Parse the directory listing HTML to extract image filenames
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, 'text/html');
    const links = doc.querySelectorAll('a[href]');
    
    imageFiles = Array.from(links)
      .map(link => link.getAttribute('href'))
      .filter(href => href && (href.endsWith('.jpg') || href.endsWith('.jpeg') || href.endsWith('.png') || href.endsWith('.gif')))
      .filter(href => !href.includes('/') && href !== '../'); // Only actual files, not directories
    
    console.log(`Found ${imageFiles.length} image files:`, imageFiles);
    return imageFiles.length > 0;
  } catch (error) {
    console.warn('Could not load directory listing:', error);
    return false;
  }
}

let score=0,collected=0,total=0,playing=false;
const container=document.querySelector('.game-container');
const scoreEl=document.getElementById('scoreValue');
const collEl=document.getElementById('collectionCount');
const totalEl=document.getElementById('totalCards');
const emojiBin=document.getElementById('collectedEmojis');
const startBtn=document.getElementById('startButton');
const windLine=document.getElementById('windLine');

startBtn.addEventListener('click', async function() {
  if(playing) return;
  
  // Load image list first if not already loaded
  if(imageFiles.length === 0) {
    startBtn.textContent = 'Loading Images...';
    startBtn.disabled = true;
    const success = await loadImageList();
    startBtn.textContent = 'Start Game';
    startBtn.disabled = false;
    
    if (!success) {
      alert('Could not load images from imgs/ directory. Make sure the web server supports directory listing.');
      return;
    }
  }
  
  start();
});

function start(){
  if(playing) return;
  playing=true;
  score=0;collected=0;total=0;
  scoreEl.textContent=score;
  collEl.textContent=collected;
  totalEl.textContent=total;
  emojiBin.innerHTML='';
  startBtn.style.display='none';

  spawn();
  const intv=setInterval(()=>{
    if(!playing){clearInterval(intv);return;}
    spawn();
  },350);

  const windIntv=setInterval(()=>{
    if(!playing){clearInterval(windIntv);return;}
    blowWind();
  },2500+Math.random()*1500);
}

function spawn(){
  total++;
  totalEl.textContent=total;

  const scene=document.createElement('div');
  scene.className='card-scene';

  /* random z between -200 (far) and 200 (close) */
  const z = (Math.random()-0.5)*400;
  scene.style.left=Math.random()*window.innerWidth+'px';
  scene.style.top='-150px';
  scene.style.transform = `translateZ(${z}px)`;

  /* size depends on z */
  const scale = 1 + z/400; // closer -> bigger
  scene.style.transform += ` scale(${scale})`;

  const inner=document.createElement('div');
  inner.className='card-inner';
  inner.style.transformStyle='preserve-3d';
  inner.style.position='absolute';
  inner.style.width='100%';
  inner.style.height='100%';

  const front=document.createElement('div');
  front.className='card-face card-front';
  
  if (imageFiles.length > 0) {
    const imageFile = imageFiles[Math.floor(Math.random() * imageFiles.length)];
    const img = document.createElement('img');
    img.src = `imgs/${imageFile}`;
    img.style.width = '100%';
    img.style.height = '100%';
    img.style.objectFit = 'cover';
    img.style.borderRadius = '10px';
    front.appendChild(img);
    front.dataset.image = imageFile;
  } else {
    // Fallback if no images loaded
    front.textContent = 'ðŸ“·';
    front.style.fontSize = '40px';
    front.dataset.image = 'fallback.jpg';
  }

  const back=document.createElement('div');
  back.className='card-face card-back';
  back.style.transform='rotateY(180deg)';

  inner.appendChild(front);
  inner.appendChild(back);
  scene.appendChild(inner);
  container.appendChild(scene);

  const dur=2+Math.random()*3;
  const endX=(Math.random()-0.5)*300;
  const rotX=(Math.random()-0.5)*720;
  const rotY=(Math.random()-0.5)*180;
  const rotZ=(Math.random()-0.5)*720;

  scene.style.transition=`transform ${dur}s linear`;
  inner.style.transition=`transform ${dur}s linear`;

  requestAnimationFrame(()=>{
    scene.style.transform=`translate3d(${endX}px, ${window.innerHeight+200}px, ${z}px) rotateX(${rotX}deg) rotateY(${rotY}deg) rotateZ(${rotZ}deg) scale(${scale})`;
  });
}

function blowWind(){
  windLine.classList.remove('blow');
  void windLine.offsetWidth;
  windLine.classList.add('blow');

  document.querySelectorAll('.card-scene').forEach(scene=>{
    const y=parseFloat(scene.style.top||0);
    if(y<0 || y>window.innerHeight-150) return;

    const newY=y-120;
    scene.style.transition='transform .8s ease-out';
    const current=scene.style.transform;
    const match=current.match(/translate3d\(([^,]+)px, ([^,]+)px, ([^)]+)px\)/);
    if(match){
      scene.style.transform=`translate3d(${match[1]}px, ${newY}px, ${match[3]}px) rotateX(${Math.random()*360}deg) rotateY(${Math.random()*360}deg) rotateZ(${Math.random()*360}deg)`;
    }
  });
}

/* ========  RADIUS-CATCH  ======== */
container.addEventListener('click',(e)=>{
  if(!playing) return;
  const RADIUS=80; // pixels
  const x=e.clientX, y=e.clientY;

  // ripple visual
  const ripple=document.createElement('div');
  ripple.className='catchRipple';
  ripple.style.left=x+'px';
  ripple.style.top=y+'px';
  container.appendChild(ripple);
  setTimeout(()=>container.removeChild(ripple),400);

  // collect cards inside radius
  document.querySelectorAll('.card-scene').forEach(scene=>{
    const rect=scene.getBoundingClientRect();
    const cx=rect.left+rect.width/2;
    const cy=rect.top+rect.height/2;
    const dx=cx-x, dy=cy-y;
    if(Math.sqrt(dx*dx+dy*dy)<=RADIUS){
      const imageFile=scene.querySelector('.card-front').dataset.image;
      collectCard(scene, imageFile);
    }
  });
});

function collectCard(scene, imageFile){
  const rect=scene.getBoundingClientRect();
  const targetRect=document.querySelector('.collection-area').getBoundingClientRect();

  // 1) straighten card
  scene.style.transition='transform .3s ease-out';
  const inner=scene.querySelector('.card-inner');
  inner.style.transition='transform .3s ease-out';

  scene.style.transform=`translate3d(${rect.left}px, ${rect.top}px, 0) rotateX(0deg) rotateY(0deg) rotateZ(0deg) scale(1)`;
  inner.style.transform='rotateY(0deg)';

  setTimeout(()=>{
    // 2) slide & shrink to collection
    scene.style.transition='transform .4s ease-out, opacity .4s ease-out';
    scene.style.transform=`translate3d(${targetRect.left-rect.left}px, ${targetRect.top-rect.top}px, 0) scale(0.2)`;
    scene.style.opacity=0;
  },300);

  setTimeout(()=>container.removeChild(scene),700);

  score+=10;
  collected++;
  scoreEl.textContent=score;
  collEl.textContent=collected;
  const thumbnailContainer=document.createElement('div');
  thumbnailContainer.className='collected-image';
  thumbnailContainer.style.cssText='width:28px;height:28px;margin:2px;display:inline-block;overflow:hidden;border-radius:4px;';
  
  const thumbnailImg=document.createElement('img');
  thumbnailImg.src=`imgs/${imageFile}`;
  thumbnailImg.style.cssText='width:100%;height:100%;object-fit:cover;';
  thumbnailImg.title=imageFile; // Show filename on hover
  
  thumbnailContainer.appendChild(thumbnailImg);
  emojiBin.appendChild(thumbnailContainer);
}
</script>
</body>
</html>